<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SED Tender Insight Hub - Profile Setup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .profile-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .profile-card:hover {
            transform: translateY(-5px);
        }
        .score-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }
        .progress-ring circle {
            fill: transparent;
            stroke: #fff;
            stroke-width: 8;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            margin-bottom: 0;
        }
        .form-section {
            border: 1px solid #e9ecef;
            border-radius: 0 0 10px 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 10px 30px;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
        }
        .alert-custom {
            border-radius: 10px;
            border: none;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .nav-pills .nav-link {
            color: #667eea;
            border-radius: 25px;
            margin-right: 10px;
        }
        .completion-badge {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-building me-2"></i>
                    SED Tender Insight Hub
                </a>
                <div class="navbar-nav ms-auto">
                    <span class="navbar-text me-3" id="userInfo">Welcome, User</span>
                    <button class="btn btn-outline-light" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-1"></i>Logout
                    </button>
                </div>
            </div>
        </nav>

        <div class="container">
            <!-- Profile Overview -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <div class="card profile-card">
                        <div class="card-body">
                            <h4 class="card-title">
                                <i class="fas fa-user-circle me-2"></i>
                                Profile Overview
                            </h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Company:</strong> <span id="companyName">-</span></p>
                                    <p><strong>Registration Number:</strong> <span id="companyReg">-</span></p>
                                    <p><strong>Phone:</strong> <span id="phoneNumber">-</span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Profile Completion:</strong> 
                                        <span class="completion-badge" id="completionBadge">0%</span>
                                    </p>
                                    <p><strong>Last Updated:</strong> <span id="lastUpdated">-</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="score-display">
                        <h5>Readiness Score</h5>
                        <div class="progress-ring">
                            <svg width="120" height="120">
                                <circle cx="60" cy="60" r="50" stroke="#fff" stroke-width="8" fill="none" opacity="0.3"/>
                                <circle cx="60" cy="60" r="50" stroke="#fff" stroke-width="8" fill="none" 
                                        stroke-dasharray="314" stroke-dashoffset="314" id="scoreCircle"/>
                            </svg>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                <h3 id="scoreValue">0</h3>
                                <small>/100</small>
                            </div>
                        </div>
                        <p class="mt-2 mb-0" id="scoreDescription">Complete your profile to improve your score</p>
                    </div>
                </div>
            </div>

            <!-- Profile Tabs -->
            <ul class="nav nav-pills mb-4" id="profileTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="cidb-tab" data-bs-toggle="pill" data-bs-target="#cidb" type="button" role="tab">
                        <i class="fas fa-hammer me-2"></i>CIDB Information
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="bee-tab" data-bs-toggle="pill" data-bs-target="#bee" type="button" role="tab">
                        <i class="fas fa-handshake me-2"></i>BEE Information
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="company-tab" data-bs-toggle="pill" data-bs-target="#company" type="button" role="tab">
                        <i class="fas fa-building me-2"></i>Company Details
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="experience-tab" data-bs-toggle="pill" data-bs-target="#experience" type="button" role="tab">
                        <i class="fas fa-chart-line me-2"></i>Experience & Performance
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="profileTabContent">
                <!-- CIDB Information Tab -->
                <div class="tab-pane fade show active" id="cidb" role="tabpanel">
                    <div class="card profile-card">
                        <h5 class="section-header">
                            <i class="fas fa-hammer me-2"></i>
                            Construction Industry Development Board (CIDB) Information
                        </h5>
                        <div class="form-section">
                            <form id="cidbForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="cidbGrade" class="form-label">CIDB Grade *</label>
                                        <select class="form-select" id="cidbGrade" name="cidb_grade">
                                            <option value="">Select Grade</option>
                                            <option value="1">Grade 1 (R0 - R200,000)</option>
                                            <option value="2">Grade 2 (R200,000 - R500,000)</option>
                                            <option value="3">Grade 3 (R500,000 - R1,000,000)</option>
                                            <option value="4">Grade 4 (R1,000,000 - R3,000,000)</option>
                                            <option value="5">Grade 5 (R3,000,000 - R8,000,000)</option>
                                            <option value="6">Grade 6 (R8,000,000 - R15,000,000)</option>
                                            <option value="7">Grade 7 (R15,000,000 - R40,000,000)</option>
                                            <option value="8">Grade 8 (R40,000,000 - R80,000,000)</option>
                                            <option value="9">Grade 9 (R80,000,000+)</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="cidbRegNumber" class="form-label">CIDB Registration Number</label>
                                        <input type="text" class="form-control" id="cidbRegNumber" name="cidb_registration_number">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="cidbExpiryDate" class="form-label">CIDB Expiry Date</label>
                                        <input type="date" class="form-control" id="cidbExpiryDate" name="cidb_expiry_date">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="cidbWorkCategories" class="form-label">Work Categories</label>
                                        <select class="form-select" id="cidbWorkCategories" name="cidb_work_categories" multiple>
                                            <option value="GB">General Building</option>
                                            <option value="CE">Civil Engineering</option>
                                            <option value="ME">Mechanical Engineering</option>
                                            <option value="EE">Electrical Engineering</option>
                                            <option value="RE">Refrigeration and Air Conditioning</option>
                                            <option value="EL">Elevator Installation</option>
                                            <option value="RO">Roads and Storm Water Drainage</option>
                                            <option value="WA">Water and Sanitation</option>
                                            <option value="EN">Environmental</option>
                                            <option value="OT">Other</option>
                                        </select>
                                        <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple categories</small>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Save CIDB Information
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- BEE Information Tab -->
                <div class="tab-pane fade" id="bee" role="tabpanel">
                    <div class="card profile-card">
                        <h5 class="section-header">
                            <i class="fas fa-handshake me-2"></i>
                            Broad-Based Black Economic Empowerment (BEE) Information
                        </h5>
                        <div class="form-section">
                            <form id="beeForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="beeLevel" class="form-label">BEE Level *</label>
                                        <select class="form-select" id="beeLevel" name="bee_level">
                                            <option value="">Select Level</option>
                                            <option value="1">Level 1 (100+ points)</option>
                                            <option value="2">Level 2 (95-99 points)</option>
                                            <option value="3">Level 3 (90-94 points)</option>
                                            <option value="4">Level 4 (80-89 points)</option>
                                            <option value="5">Level 5 (75-79 points)</option>
                                            <option value="6">Level 6 (70-74 points)</option>
                                            <option value="7">Level 7 (55-69 points)</option>
                                            <option value="8">Level 8 (40-54 points)</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="beeCertNumber" class="form-label">BEE Certificate Number</label>
                                        <input type="text" class="form-control" id="beeCertNumber" name="bee_certificate_number">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="beeExpiryDate" class="form-label">BEE Expiry Date</label>
                                        <input type="date" class="form-control" id="beeExpiryDate" name="bee_expiry_date">
                                    </div>
                                </div>
                                
                                <h6 class="mt-4 mb-3">BEE Scorecard Elements</h6>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="beeOwnership" class="form-label">Ownership %</label>
                                        <input type="number" class="form-control" id="beeOwnership" name="bee_ownership_percentage" min="0" max="100" step="0.01">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="beeManagement" class="form-label">Management Control %</label>
                                        <input type="number" class="form-control" id="beeManagement" name="bee_management_control_percentage" min="0" max="100" step="0.01">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="beeSkills" class="form-label">Skills Development %</label>
                                        <input type="number" class="form-control" id="beeSkills" name="bee_skills_development_percentage" min="0" max="100" step="0.01">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="beeEnterprise" class="form-label">Enterprise Development %</label>
                                        <input type="number" class="form-control" id="beeEnterprise" name="bee_enterprise_development_percentage" min="0" max="100" step="0.01">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="beeSocio" class="form-label">Socio-Economic Development %</label>
                                        <input type="number" class="form-control" id="beeSocio" name="bee_socio_economic_development_percentage" min="0" max="100" step="0.01">
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Save BEE Information
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Company Details Tab -->
                <div class="tab-pane fade" id="company" role="tabpanel">
                    <div class="card profile-card">
                        <h5 class="section-header">
                            <i class="fas fa-building me-2"></i>
                            Company Information
                        </h5>
                        <div class="form-section">
                            <form id="companyForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="companyName" class="form-label">Company Name *</label>
                                        <input type="text" class="form-control" id="companyName" name="company_name" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="companyRegNumber" class="form-label">Company Registration Number</label>
                                        <input type="text" class="form-control" id="companyRegNumber" name="company_registration_number">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="phoneNumber" class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="phoneNumber" name="phone_number">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="yearsInBusiness" class="form-label">Years in Business</label>
                                        <input type="number" class="form-control" id="yearsInBusiness" name="years_in_business" min="0">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="annualTurnover" class="form-label">Annual Turnover (ZAR)</label>
                                        <input type="number" class="form-control" id="annualTurnover" name="annual_turnover" min="0" step="0.01">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="numberOfEmployees" class="form-label">Number of Employees</label>
                                        <input type="number" class="form-control" id="numberOfEmployees" name="number_of_employees" min="0">
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Save Company Information
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Experience & Performance Tab -->
                <div class="tab-pane fade" id="experience" role="tabpanel">
                    <div class="card profile-card">
                        <h5 class="section-header">
                            <i class="fas fa-chart-line me-2"></i>
                            Experience & Performance
                        </h5>
                        <div class="form-section">
                            <form id="experienceForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="previousTenderWins" class="form-label">Previous Tender Wins</label>
                                        <input type="number" class="form-control" id="previousTenderWins" name="previous_tender_wins" min="0">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="previousTenderApplications" class="form-label">Previous Tender Applications</label>
                                        <input type="number" class="form-control" id="previousTenderApplications" name="previous_tender_applications" min="0">
                                    </div>
                                </div>
                                
                                <div class="alert alert-info alert-custom">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Success Rate:</strong> <span id="successRate">0%</span>
                                    <br>
                                    <small>This is calculated as (Wins / Applications) × 100</small>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Save Experience Information
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="row mb-4">
                <div class="col-12 text-center">
                    <button class="btn btn-success btn-lg me-3" onclick="recalculateScore()">
                        <i class="fas fa-calculator me-2"></i>Recalculate Score
                    </button>
                    <button class="btn btn-info btn-lg" onclick="exportProfile()">
                        <i class="fas fa-download me-2"></i>Export Profile
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p>Processing your request...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Error Alerts -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="alertToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-check-circle text-success me-2"></i>
                <strong class="me-auto">Success</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Profile updated successfully!
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>

